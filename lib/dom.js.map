{"version":3,"sources":["../src/dom.js"],"names":["Content","Tail","TypeError","props","state","tail","width","height","content","parent","top","left","anchor","handleScroll","bind","window","_node","node","parentNode","isParentNode","style","getWindow","getComputedStyle","position","tagName","parentClass","scrollishStyle","indexOf","className","overflow","overflowX","overflowY","getAnchorParent","findDOMNode","refs","flowtip","getBoundingParent","getAnchorElement","getBoundingClientRect","element","getParentElement","scrollerWidth","offsetWidth","clientWidth","scrollerHeight","offsetHeight","clientHeight","rect","right","bottom","clamp","Math","max","min","innerHeight","innerWidth","onReflow","updateState","setState","getParentRect","getAnchorRect","addEventListener","removeEventListener","region","offset","target","data","children","detached","visibility","defaultProps"],"mappings":";;;;;;;;;;AACA;;AACA;;;;AAEA;;;;AACA;;;;;;;;;;+eALA;;;kBAOe,UAACA,OAAD,EAAUC,IAAV,EAAmB;AAAA;;AAChC,MAAI,OAAOD,OAAP,KAAoB,UAAxB,EAAoC;AAClC,UAAM,IAAIE,SAAJ,CAAc,sCAAd,CAAN;AACD;;AAED,MAAI,OAAOD,IAAP,KAAiB,UAArB,EAAiC;AAC/B,UAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;AACD;;AAED;AAAA;;AAYE,wBAAYC,KAAZ,EAAmB;AAAA;;AAAA,0HACXA,KADW;;AAAA,YAPnBC,KAOmB,GAPX;AACNC,cAAM,EAACC,OAAO,CAAR,EAAWC,QAAQ,CAAnB,EADA;AAENC,iBAAS,EAACF,OAAO,CAAR,EAAWC,QAAQ,CAAnB,EAFH;AAGNE,gBAAQ,EAACC,KAAK,CAAN,EAASC,MAAM,CAAf,EAAkBL,OAAO,CAAzB,EAA4BC,QAAQ,CAApC,EAHF;AAINK,gBAAQ,EAACF,KAAK,CAAN,EAASC,MAAM,CAAf,EAAkBL,OAAO,CAAzB,EAA4BC,QAAQ,CAApC;AAJF,OAOW;;AAEjB,YAAKM,YAAL,GAAoB,MAAKA,YAAL,CAAkBC,IAAlB,OAApB;AAFiB;AAGlB;;AAfH;AAAA;AAAA,kCAiBc;AACV,eAAOC,MAAP;AACD;;AAED;;;;;;;AArBF;AAAA;AAAA,sCA2BkBC,KA3BlB,EA2ByB;AAAA;;AACrB,YAAIC,OAAOD,MAAME,UAAjB;AACA,YAAMC,eAAe,SAAfA,YAAe,CAACF,IAAD,EAAU;AAC7B,cAAMG,QAAQ,OAAKC,SAAL,GAAiBC,gBAAjB,CAAkCL,IAAlC,CAAd;AACA,iBAAOG,SAASA,MAAMG,QAAN,KAAmB,QAAnC;AACD,SAHD;;AAKA,eAAON,IAAP,EAAa;AACX,cAAIE,aAAaF,IAAb,KAAsBA,KAAKO,OAAL,KAAiB,MAA3C,EAAmD;AACjD,mBAAOP,IAAP;AACD;AACDA,iBAAOA,KAAKC,UAAZ;AACD;AACD,eAAOD,IAAP;AACD;;AAED;;;;;;;;AA3CF;AAAA;AAAA,wCAkDoBD,KAlDpB,EAkD+C;AAAA;;AAAA,YAApBS,WAAoB,uEAAN,IAAM;;AAC3C,YAAIR,OAAOD,MAAME,UAAjB;AACA,YAAMQ,iBAAiB,SAAjBA,cAAiB,CAACN,KAAD;AAAA,iBAAW,CAChC,MADgC,EAEhC,QAFgC,EAGhC,QAHgC,EAIhCO,OAJgC,CAIxBP,KAJwB,MAIb,CAAC,CAJC;AAAA,SAAvB;;AAMA,YAAMD,eAAe,SAAfA,YAAe,CAACF,IAAD,EAAU;AAC7B,cAAMG,QAAQ,OAAKC,SAAL,GAAiBC,gBAAjB,CAAkCL,IAAlC,CAAd;AACA,cAAIQ,WAAJ,EAAiB;AACf,mBAAOR,KAAKW,SAAL,CAAeD,OAAf,CAAuBF,WAAvB,MAAwC,CAAC,CAAhD;AACD,WAFD,MAEO,IAAIL,KAAJ,EAAW;AAChB,mBAAOM,eAAeN,MAAMS,QAArB,KACLH,eAAeN,MAAMU,SAArB,CADK,IAELJ,eAAeN,MAAMW,SAArB,CAFF;AAGD;AACD,iBAAO,KAAP;AACD,SAVD;;AAYA,eAAOd,IAAP,EAAa;AACX,cAAIE,aAAaF,IAAb,KAAsBA,KAAKO,OAAL,KAAiB,MAA3C,EAAmD;AACjD,mBAAOP,IAAP;AACD;AACDA,iBAAOA,KAAKC,UAAZ;AACD;AACD,eAAOD,IAAP;AACD;AA7EH;AAAA;AAAA,yCA+EqB;AACjB,eAAO,KAAKe,eAAL,CAAqB,mBAASC,WAAT,CAAqB,KAAKC,IAAL,CAAUC,OAA/B,CAArB,CAAP;AACD;AAjFH;AAAA;AAAA,yCAmFqB;AAAA,YACVV,WADU,GACK,KAAKtB,KADV,CACVsB,WADU;;AAEjB,eAAO,KAAKW,iBAAL,CAAuB,KAAKC,gBAAL,EAAvB,EAAgDZ,WAAhD,CAAP;AACD;AAtFH;AAAA;AAAA,sCAwFkB;AACd,YAAMb,SAAS,KAAKyB,gBAAL,GAAwBC,qBAAxB,EAAf;AACA,eAAO;AACL5B,eAAKE,OAAOF,GADP;AAELC,gBAAMC,OAAOD,IAFR;AAGLL,iBAAOM,OAAON,KAHT;AAILC,kBAAQK,OAAOL;AAJV,SAAP;AAMD;;AAED;;;;;;AAlGF;AAAA;AAAA,sCAuGkB;AACd,YAAMgC,UAAU,KAAKC,gBAAL,EAAhB;AACA,YAAMC,gBAAgBF,QAAQG,WAAR,GAAsBH,QAAQI,WAApD;AACA,YAAMC,iBAAiBL,QAAQM,YAAR,GAAuBN,QAAQO,YAAtD;AACA,YAAMC,OAAOR,QAAQD,qBAAR,EAAb;AACA,YAAM7B,SAAS;AACbE,gBAAMoC,KAAKpC,IADE;AAEbD,eAAKqC,KAAKrC,GAFG;AAGbJ,iBAAOyC,KAAKC,KAAL,GAAaD,KAAKpC,IAHZ;AAIbJ,kBAAQwC,KAAKE,MAAL,GAAcF,KAAKrC;AAJd,SAAf;AAMA;AACA;AACA,YAAI,KAAKP,KAAL,CAAW+C,KAAf,EAAsB;AACpBzC,iBAAOE,IAAP,GAAcwC,KAAKC,GAAL,CAAS3C,OAAOE,IAAhB,EAAsB,CAAtB,CAAd;AACAF,iBAAOC,GAAP,GAAayC,KAAKC,GAAL,CAAS3C,OAAOC,GAAhB,EAAqB,CAArB,CAAb;AACAD,iBAAOF,MAAP,GAAgB4C,KAAKE,GAAL,CACd5C,OAAOF,MADO,EAEd,KAAKc,SAAL,GAAiBiC,WAAjB,GAA+B7C,OAAOC,GAFxB,CAAhB;AAIAD,iBAAOH,KAAP,GAAe6C,KAAKE,GAAL,CACb5C,OAAOH,KADM,EAEb,KAAKe,SAAL,GAAiBkC,UAAjB,GAA8B9C,OAAOE,IAFxB,CAAf;AAID;AACDF,eAAOH,KAAP,IAAgBmC,aAAhB;AACAhC,eAAOF,MAAP,IAAiBqC,cAAjB;AACA,eAAOnC,MAAP;AACD;AAnIH;AAAA;AAAA,qCAqIiB;AACb,aAAKN,KAAL,CAAWqD,QAAX;AACA,aAAKC,WAAL;AACD;AAxIH;AAAA;AAAA,oCA0IgB;AACZ,aAAKC,QAAL,CAAc;AACZjD,kBAAQ,KAAKkD,aAAL,EADI;AAEZ/C,kBAAQ,KAAKgD,aAAL;AAFI,SAAd;AAID;AA/IH;AAAA;AAAA,0CAiJsB;AAClB,YAAMnD,SAAS,KAAK+B,gBAAL,EAAf;AACA,aAAKiB,WAAL;AACA,aAAKpC,SAAL,GAAiBwC,gBAAjB,CAAkC,QAAlC,EAA4C,KAAKhD,YAAjD;AACAJ,eAAOoD,gBAAP,CAAwB,QAAxB,EAAkC,KAAKhD,YAAvC;AACD;AAtJH;AAAA;AAAA,6CAwJyB;AACrB,YAAMJ,SAAS,KAAK+B,gBAAL,EAAf;AACA,aAAKnB,SAAL,GAAiByC,mBAAjB,CAAqC,QAArC,EAA+C,KAAKjD,YAApD;AACAJ,eAAOqD,mBAAP,CAA2B,QAA3B,EAAqC,KAAKjD,YAA1C;AACD;AA5JH;AAAA;AAAA,+BA8JW;AAAA;;AACP,eACE;AACE,eAAI,SADN;AAEE,kBAAQ,KAAKT,KAAL,CAAWK,MAFrB;AAGE,kBAAQ,KAAKL,KAAL,CAAWQ,MAHrB;AAIE,gBAAM,KAAKR,KAAL,CAAWC,IAJnB;AAKE,mBAAS,KAAKD,KAAL,CAAWI,OALtB;AAME,kBAAQ,KAAKJ,KAAL,CAAW2D,MANrB;AAOE,kBAAQ,KAAK3D,KAAL,CAAW4D;AAPrB,WAQM,KAAK7D,KARX;AASE,oBAAU;AAAA,gBAAE4D,MAAF,QAAEA,MAAF;AAAA,gBAAUvD,OAAV,QAAUA,OAAV;AAAA,gBAAmBH,IAAnB,QAAmBA,IAAnB;AAAA,gBAAyB4D,MAAzB,QAAyBA,MAAzB;AAAA,gBAAiCxD,MAAjC,QAAiCA,MAAjC;AAAA,mBACR;AAAC,qBAAD;AAAA;AACE,wBAAQsD,MADV;AAEE,0BAAUvD,QAAQe,QAFpB;AAGE,wBAAQ0C,MAHV;AAIE,wBAAQxD,MAJV;AAKE,uBAAO;AACLc,4BAAU,UADL;AAELZ,wBAAMH,QAAQe,QAAR,CAAiBZ,IAFlB;AAGLD,uBAAKF,QAAQe,QAAR,CAAiBb;AAHjB;AALT,iBAUM,OAAKP,KAAL,CAAW+D,IAVjB;AAYG,qBAAK/D,KAAL,CAAWgE,QAZd;AAaE,yEAAgB,UAAU,kBAAC3D,OAAD;AAAA,yBAAa,OAAKkD,QAAL,CAAc,EAAClD,gBAAD,EAAd,CAAb;AAAA,iBAA1B,GAbF;AAcE;AAAC,oBAAD;AAAA;AACE,4BAAUH,KAAKkB,QADjB;AAEE,0BAAQ0C,MAFV;AAGE,0BAAQxD,MAHV;AAIE,0BAAQsD,MAJV;AAKE,4BAAU1D,KAAK+D,QALjB;AAME,yBAAO;AACL7C,8BAAU,UADL;AAELZ,0BAAMN,KAAKkB,QAAL,CAAcZ,IAFf;AAGLD,yBAAKL,KAAKkB,QAAL,CAAcb,GAHd;AAIL2D,gCAAYhE,KAAK+D,QAAL,GAAgB,QAAhB,GAA2B;AAJlC;AANT,mBAYM,OAAKjE,KAAL,CAAW+D,IAZjB;AAcE,2EAAgB,UAAU,kBAAC7D,IAAD;AAAA,2BAAU,OAAKqD,QAAL,CAAc,EAACrD,UAAD,EAAd,CAAV;AAAA,mBAA1B;AAdF;AAdF,aADQ;AAAA;AATZ,WADF;AA6CD;AA5MH;;AAAA;AAAA,8BACSiE,YADT,GACwB;AACpBpB,WAAO;AADa,GADxB;AA8MD,C","file":"dom.js","sourcesContent":["/* global window */\nimport {createElement, Component} from 'react';\nimport ReactDOM from 'react-dom';\n\nimport FlowTip from './flowtip';\nimport ResizeObserver from 'react-resize-observer';\n\nexport default (Content, Tail) => {\n  if (typeof(Content) !== 'function') {\n    throw new TypeError('Content component is not a function.');\n  }\n\n  if (typeof(Tail) !== 'function') {\n    throw new TypeError('Tail component is not a function.');\n  }\n\n  return class FlowTipDOM extends Component {\n    static defaultProps = {\n      clamp: true,\n    };\n\n    state = {\n      tail: {width: 0, height: 0},\n      content: {width: 0, height: 0},\n      parent: {top: 0, left: 0, width: 0, height: 0},\n      anchor: {top: 0, left: 0, width: 0, height: 0},\n    };\n\n    constructor(props) {\n      super(props);\n      this.handleScroll = this.handleScroll.bind(this);\n    }\n\n    getWindow() {\n      return window;\n    }\n\n    /**\n     * Find the closest node that will control the positioning of the FlowTip™\n     * content.\n     * @param   {Node} _node Initial node to search from.\n     * @returns {Node} The anchor parent.\n     */\n    getAnchorParent(_node) {\n      let node = _node.parentNode;\n      const isParentNode = (node) => {\n        const style = this.getWindow().getComputedStyle(node);\n        return style && style.position !== 'static';\n      };\n\n      while (node) {\n        if (isParentNode(node) || node.tagName === 'BODY') {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return node;\n    }\n\n    /**\n     * Find the closest node that should enclose the FlowTip™'s content.\n     * Basically the nearest thing with scrollbars.\n     * @param   {[type]} _node       [description]\n     * @param   {[type]} parentClass =             null [description]\n     * @returns {[type]}             [description]\n     */\n    getBoundingParent(_node, parentClass = null) {\n      let node = _node.parentNode;\n      const scrollishStyle = (style) => [\n        'auto',\n        'hidden',\n        'scroll',\n      ].indexOf(style) !== -1;\n\n      const isParentNode = (node) => {\n        const style = this.getWindow().getComputedStyle(node);\n        if (parentClass) {\n          return node.className.indexOf(parentClass) !== -1;\n        } else if (style) {\n          return scrollishStyle(style.overflow) ||\n            scrollishStyle(style.overflowX) ||\n            scrollishStyle(style.overflowY);\n        }\n        return false;\n      };\n\n      while (node) {\n        if (isParentNode(node) || node.tagName === 'BODY') {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return node;\n    }\n\n    getAnchorElement() {\n      return this.getAnchorParent(ReactDOM.findDOMNode(this.refs.flowtip));\n    }\n\n    getParentElement() {\n      const {parentClass} = this.props;\n      return this.getBoundingParent(this.getAnchorElement(), parentClass);\n    }\n\n    getAnchorRect() {\n      const anchor = this.getAnchorElement().getBoundingClientRect();\n      return {\n        top: anchor.top,\n        left: anchor.left,\n        width: anchor.width,\n        height: anchor.height,\n      };\n    }\n\n    /**\n     * Calculate the bounding parent. This is the rect in which the tooltip\n     * must be contained.\n     * @returns {Object} Bounding rect.\n     */\n    getParentRect() {\n      const element = this.getParentElement();\n      const scrollerWidth = element.offsetWidth - element.clientWidth;\n      const scrollerHeight = element.offsetHeight - element.clientHeight;\n      const rect = element.getBoundingClientRect();\n      const parent = {\n        left: rect.left,\n        top: rect.top,\n        width: rect.right - rect.left,\n        height: rect.bottom - rect.top,\n      };\n      // In addition to taking the parent element into consideration, take the\n      // viewport into consideration too.\n      if (this.props.clamp) {\n        parent.left = Math.max(parent.left, 0);\n        parent.top = Math.max(parent.top, 0);\n        parent.height = Math.min(\n          parent.height,\n          this.getWindow().innerHeight - parent.top\n        );\n        parent.width = Math.min(\n          parent.width,\n          this.getWindow().innerWidth - parent.left\n        );\n      }\n      parent.width -= scrollerWidth;\n      parent.height -= scrollerHeight;\n      return parent;\n    }\n\n    handleScroll() {\n      this.props.onReflow();\n      this.updateState();\n    }\n\n    updateState() {\n      this.setState({\n        parent: this.getParentRect(),\n        anchor: this.getAnchorRect(),\n      });\n    }\n\n    componentDidMount() {\n      const parent = this.getParentElement();\n      this.updateState();\n      this.getWindow().addEventListener('scroll', this.handleScroll);\n      parent.addEventListener('scroll', this.handleScroll);\n    }\n\n    componentWillUnmount() {\n      const parent = this.getParentElement();\n      this.getWindow().removeEventListener('scroll', this.handleScroll);\n      parent.removeEventListener('scroll', this.handleScroll);\n    }\n\n    render() {\n      return (\n        <FlowTip\n          ref='flowtip'\n          parent={this.state.parent}\n          anchor={this.state.anchor}\n          tail={this.state.tail}\n          content={this.state.content}\n          region={this.state.region}\n          offset={this.state.offset}\n          {...this.props}\n          children={({region, content, tail, target, parent}) => (\n            <Content\n              region={region}\n              position={content.position}\n              target={target}\n              parent={parent}\n              style={{\n                position: 'absolute',\n                left: content.position.left,\n                top: content.position.top,\n              }}\n              {...this.props.data}\n            >\n              {this.props.children}\n              <ResizeObserver onResize={(content) => this.setState({content})}/>\n              <Tail\n                position={tail.position}\n                target={target}\n                parent={parent}\n                region={region}\n                detached={tail.detached}\n                style={{\n                  position: 'absolute',\n                  left: tail.position.left,\n                  top: tail.position.top,\n                  visibility: tail.detached ? 'hidden' : 'visible',\n                }}\n                {...this.props.data}\n              >\n                <ResizeObserver onResize={(tail) => this.setState({tail})}/>\n              </Tail>\n            </Content>\n          )}\n        />\n      );\n    }\n  };\n};\n"]}