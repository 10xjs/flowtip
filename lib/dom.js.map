{"version":3,"sources":["../src/dom.js"],"names":[],"mappings":"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","file":"dom.js","sourcesContent":["/* global window */\nimport {createElement, Component} from 'react';\nimport ReactDOM from 'react-dom';\n\nimport FlowTip from './flowtip';\nimport ResizeObserver from 'react-resize-observer';\n\nexport default (Content, Tail) => {\n  if (typeof(Content) !== 'function') {\n    throw new TypeError('Content component is not a function.');\n  }\n\n  if (typeof(Tail) !== 'function') {\n    throw new TypeError('Tail component is not a function.');\n  }\n\n  return class FlowTipDOM extends Component {\n    static defaultProps = {\n      clamp: true,\n    };\n\n    state = {\n      tail: {width: 0, height: 0},\n      content: {width: 0, height: 0},\n      parent: {top: 0, left: 0, width: 0, height: 0},\n      anchor: {top: 0, left: 0, width: 0, height: 0},\n    };\n\n    constructor(props) {\n      super(props);\n      this.handleScroll = this.handleScroll.bind(this);\n    }\n\n    getWindow() {\n      return window;\n    }\n\n    /**\n     * Find the closest node that will control the positioning of the FlowTip™\n     * content.\n     * @param   {Node} _node Initial node to search from.\n     * @returns {Node} The anchor parent.\n     */\n    getAnchorParent(_node) {\n      let node = _node.parentNode;\n      const isParentNode = (node) => {\n        const style = this.getWindow().getComputedStyle(node);\n        return style && style.position !== 'static';\n      };\n\n      while (node) {\n        if (isParentNode(node) || node.tagName === 'BODY') {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return node;\n    }\n\n    /**\n     * Find the closest node that should enclose the FlowTip™'s content.\n     * Basically the nearest thing with scrollbars.\n     * @param   {[type]} _node       [description]\n     * @param   {[type]} parentClass =             null [description]\n     * @returns {[type]}             [description]\n     */\n    getBoundingParent(_node, parentClass = null) {\n      let node = _node.parentNode;\n      const scrollishStyle = (style) => [\n        'auto',\n        'hidden',\n        'scroll',\n      ].indexOf(style) !== -1;\n\n      const isParentNode = (node) => {\n        const style = this.getWindow().getComputedStyle(node);\n        if (parentClass) {\n          return node.className.indexOf(parentClass) !== -1;\n        } else if (style) {\n          return scrollishStyle(style.overflow) ||\n            scrollishStyle(style.overflowX) ||\n            scrollishStyle(style.overflowY);\n        }\n        return false;\n      };\n\n      while (node) {\n        if (isParentNode(node) || node.tagName === 'BODY') {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return node;\n    }\n\n    getAnchorElement() {\n      return this.getAnchorParent(ReactDOM.findDOMNode(this.refs.flowtip));\n    }\n\n    getParentElement() {\n      const {parentClass} = this.props;\n      return this.getBoundingParent(this.getAnchorElement(), parentClass);\n    }\n\n    getAnchorRect() {\n      const anchor = this.getAnchorElement().getBoundingClientRect();\n      return {\n        top: anchor.top,\n        left: anchor.left,\n        width: anchor.width,\n        height: anchor.height,\n      };\n    }\n\n    /**\n     * Calculate the bounding parent. This is the rect in which the tooltip\n     * must be contained.\n     * @returns {Object} Bounding rect.\n     */\n    getParentRect() {\n      const element = this.getParentElement();\n      const scrollerWidth = element.offsetWidth - element.clientWidth;\n      const scrollerHeight = element.offsetHeight - element.clientHeight;\n      const rect = element.getBoundingClientRect();\n      const parent = {\n        left: rect.left,\n        top: rect.top,\n        width: rect.right - rect.left,\n        height: rect.bottom - rect.top,\n      };\n      // In addition to taking the parent element into consideration, take the\n      // viewport into consideration too.\n      if (this.props.clamp) {\n        parent.left = Math.max(parent.left, 0);\n        parent.top = Math.max(parent.top, 0);\n        parent.height = Math.min(\n          parent.height,\n          this.getWindow().innerHeight - parent.top\n        );\n        parent.width = Math.min(\n          parent.width,\n          this.getWindow().innerWidth - parent.left\n        );\n      }\n      parent.width -= scrollerWidth;\n      parent.height -= scrollerHeight;\n      return parent;\n    }\n\n    handleScroll() {\n      this.props.onReflow();\n      this.updateState();\n    }\n\n    updateState() {\n      this.setState({\n        parent: this.getParentRect(),\n        anchor: this.getAnchorRect(),\n      });\n    }\n\n    componentDidMount() {\n      const parent = this.getParentElement();\n      this.updateState();\n      this.getWindow().addEventListener('scroll', this.handleScroll);\n      parent.addEventListener('scroll', this.handleScroll);\n    }\n\n    componentWillUnmount() {\n      const parent = this.getParentElement();\n      this.getWindow().removeEventListener('scroll', this.handleScroll);\n      parent.removeEventListener('scroll', this.handleScroll);\n    }\n\n    render() {\n      return (\n        <FlowTip\n          ref='flowtip'\n          parent={this.state.parent}\n          anchor={this.state.anchor}\n          tail={this.state.tail}\n          content={this.state.content}\n          region={this.state.region}\n          offset={this.state.offset}\n          {...this.props}\n          children={({region, content, tail, target, parent}) => (\n            <Content\n              region={region}\n              position={content.position}\n              target={target}\n              parent={parent}\n              style={{\n                position: 'absolute',\n                left: content.position.left,\n                top: content.position.top,\n              }}\n              {...this.props.data}\n            >\n              {this.props.children}\n              <ResizeObserver onResize={(content) => this.setState({content})}/>\n              <Tail\n                position={tail.position}\n                target={target}\n                parent={parent}\n                region={region}\n                detached={tail.detached}\n                style={{\n                  position: 'absolute',\n                  left: tail.position.left,\n                  top: tail.position.top,\n                  visibility: tail.detached ? 'hidden' : 'visible',\n                }}\n                {...this.props.data}\n              >\n                <ResizeObserver onResize={(tail) => this.setState({tail})}/>\n              </Tail>\n            </Content>\n          )}\n        />\n      );\n    }\n  };\n};\n"]}