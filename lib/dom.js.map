{"version":3,"sources":["../src/dom.js"],"names":["Content","Tail","TypeError","props","state","tail","width","height","content","parent","top","left","anchor","handleScroll","bind","window","Node","ELEMENT_NODE","node","nodeType","getElementNode","getWindow","getComputedStyle","_node","parentNode","isParentNode","style","getDerivedStyle","position","tagName","parentClass","scrollishStyle","indexOf","className","overflow","overflowX","overflowY","getAnchorParent","findDOMNode","refs","flowtip","getBoundingParent","getAnchorElement","getBoundingClientRect","element","getParentElement","scrollerWidth","offsetWidth","clientWidth","scrollerHeight","offsetHeight","clientHeight","rect","right","bottom","clamp","Math","max","min","innerHeight","innerWidth","onReflow","updateState","setState","getParentRect","getAnchorRect","addEventListener","removeEventListener","region","offset","target","data","children","detached","visibility","defaultProps"],"mappings":"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","file":"dom.js","sourcesContent":["/* global window,Node */\nimport {createElement, Component} from 'react';\nimport ReactDOM from 'react-dom';\n\nimport FlowTip from './flowtip';\nimport ResizeObserver from 'react-resize-observer';\n\nexport default (Content, Tail) => {\n  if (typeof(Content) !== 'function') {\n    throw new TypeError('Content component is not a function.');\n  }\n\n  if (typeof(Tail) !== 'function') {\n    throw new TypeError('Tail component is not a function.');\n  }\n\n  return class FlowTipDOM extends Component {\n    static defaultProps = {\n      clamp: true,\n    };\n\n    state = {\n      tail: {width: 0, height: 0},\n      content: {width: 0, height: 0},\n      parent: {top: 0, left: 0, width: 0, height: 0},\n      anchor: {top: 0, left: 0, width: 0, height: 0},\n    };\n\n    constructor(props) {\n      super(props);\n      this.handleScroll = this.handleScroll.bind(this);\n    }\n\n    getWindow() {\n      return window;\n    }\n\n    getElementNode() {\n      // only IE has Node as an object, most everyone else has it as a function\n      return (typeof Node === 'function' || typeof Node === 'object') &&\n        typeof Node.ELEMENT_NODE === 'number' ?  Node.ELEMENT_NODE : null;\n    }\n\n    getDerivedStyle(node) {\n      if (!(node && node.nodeType === this.getElementNode())) {\n        return null;\n      }\n      return this.getWindow().getComputedStyle(node);\n    }\n\n    /**\n     * Find the closest node that will control the positioning of the FlowTip™\n     * content.\n     * @param   {Node} _node Initial node to search from.\n     * @returns {Node} The anchor parent.\n     */\n    getAnchorParent(_node) {\n      let node = _node.parentNode;\n      const isParentNode = (node) => {\n        const style = this.getDerivedStyle(node);\n        return style && style.position !== 'static';\n      };\n\n      while (node) {\n        if (isParentNode(node) || node.tagName === 'BODY') {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return node;\n    }\n\n    /**\n     * Find the closest node that should enclose the FlowTip™'s content.\n     * Basically the nearest thing with scrollbars.\n     * @param   {[type]} _node       [description]\n     * @param   {[type]} parentClass =             null [description]\n     * @returns {[type]}             [description]\n     */\n    getBoundingParent(_node, parentClass = null) {\n      let node = _node.parentNode;\n      const scrollishStyle = (style) => [\n        'auto',\n        'hidden',\n        'scroll',\n      ].indexOf(style) !== -1;\n\n      const isParentNode = (node) => {\n        const style = this.getDerivedStyle(node);\n        if (parentClass) {\n          return node.className.indexOf(parentClass) !== -1;\n        } else if (style) {\n          return scrollishStyle(style.overflow) ||\n            scrollishStyle(style.overflowX) ||\n            scrollishStyle(style.overflowY);\n        }\n        return false;\n      };\n\n      while (node) {\n        if (isParentNode(node) || node.tagName === 'BODY') {\n          return node;\n        }\n        node = node.parentNode;\n      }\n      return node;\n    }\n\n    getAnchorElement() {\n      return this.getAnchorParent(ReactDOM.findDOMNode(this.refs.flowtip));\n    }\n\n    getParentElement() {\n      const {parentClass} = this.props;\n      return this.getBoundingParent(this.getAnchorElement(), parentClass);\n    }\n\n    getAnchorRect() {\n      const anchor = this.getAnchorElement().getBoundingClientRect();\n      return {\n        top: anchor.top,\n        left: anchor.left,\n        width: anchor.width,\n        height: anchor.height,\n      };\n    }\n\n    /**\n     * Calculate the bounding parent. This is the rect in which the tooltip\n     * must be contained.\n     * @returns {Object} Bounding rect.\n     */\n    getParentRect() {\n      const element = this.getParentElement();\n      const scrollerWidth = element.offsetWidth - element.clientWidth;\n      const scrollerHeight = element.offsetHeight - element.clientHeight;\n      const rect = element.getBoundingClientRect();\n      const parent = {\n        left: rect.left,\n        top: rect.top,\n        width: rect.right - rect.left,\n        height: rect.bottom - rect.top,\n      };\n      // In addition to taking the parent element into consideration, take the\n      // viewport into consideration too.\n      if (this.props.clamp) {\n        parent.left = Math.max(parent.left, 0);\n        parent.top = Math.max(parent.top, 0);\n        parent.height = Math.min(\n          parent.height,\n          this.getWindow().innerHeight - parent.top\n        );\n        parent.width = Math.min(\n          parent.width,\n          this.getWindow().innerWidth - parent.left\n        );\n      }\n      parent.width -= scrollerWidth;\n      parent.height -= scrollerHeight;\n      return parent;\n    }\n\n    handleScroll() {\n      this.props.onReflow();\n      this.updateState();\n    }\n\n    updateState() {\n      this.setState({\n        parent: this.getParentRect(),\n        anchor: this.getAnchorRect(),\n      });\n    }\n\n    componentDidMount() {\n      const parent = this.getParentElement();\n      this.updateState();\n      this.getWindow().addEventListener('scroll', this.handleScroll);\n      parent.addEventListener('scroll', this.handleScroll);\n    }\n\n    componentWillUnmount() {\n      const parent = this.getParentElement();\n      this.getWindow().removeEventListener('scroll', this.handleScroll);\n      parent.removeEventListener('scroll', this.handleScroll);\n    }\n\n    render() {\n      return (\n        <FlowTip\n          ref='flowtip'\n          parent={this.state.parent}\n          anchor={this.state.anchor}\n          tail={this.state.tail}\n          content={this.state.content}\n          region={this.state.region}\n          offset={this.state.offset}\n          {...this.props}\n          children={({region, content, tail, target, parent}) => (\n            <Content\n              region={region}\n              position={content.position}\n              target={target}\n              parent={parent}\n              style={{\n                position: 'absolute',\n                left: content.position.left,\n                top: content.position.top,\n              }}\n              {...this.props.data}\n            >\n              {this.props.children}\n              <ResizeObserver onResize={(content) => this.setState({content})}/>\n              <Tail\n                position={tail.position}\n                target={target}\n                parent={parent}\n                region={region}\n                detached={tail.detached}\n                style={{\n                  position: 'absolute',\n                  left: tail.position.left,\n                  top: tail.position.top,\n                  visibility: tail.detached ? 'hidden' : 'visible',\n                }}\n                {...this.props.data}\n              >\n                <ResizeObserver onResize={(tail) => this.setState({tail})}/>\n              </Tail>\n            </Content>\n          )}\n        />\n      );\n    }\n  };\n};\n"]}